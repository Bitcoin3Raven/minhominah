<!DOCTYPE html>
<html>
<head>
    <title>Storage 테스트</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Storage 업로드 테스트</h1>
    <button onclick="testUpload()">테스트 업로드</button>
    <div id="result"></div>

    <script>
        // Supabase 초기화
        const supabaseUrl = 'https://illwscrdeyncckltjrmr.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlsbHdzY3JkZXluY2NrbHRqcm1yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzI4MDMwNTIsImV4cCI6MjA0ODM3OTA1Mn0.jCilwxRjFJKGT4ce4b0LsMkWoJXDTe8sLxnZRlRvMDc';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        async function testUpload() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '테스트 중...';

            try {
                // 사용자 확인
                const { data: { user } } = await supabase.auth.getUser();
                if (!user) {
                    resultDiv.innerHTML = '로그인이 필요합니다.';
                    return;
                }

                // 여러 경로 테스트
                const tests = [
                    { path: `test-${Date.now()}.txt`, desc: '루트 경로' },
                    { path: `memories/test-${Date.now()}.txt`, desc: 'memories 폴더' },
                    { path: `memories/${user.id}/test-${Date.now()}.txt`, desc: '사용자 폴더' },
                ];

                let results = '<h2>테스트 결과:</h2>';
                
                for (const test of tests) {
                    const testFile = new Blob(['test content'], { type: 'text/plain' });
                    
                    const { data, error } = await supabase.storage
                        .from('media')
                        .upload(test.path, testFile);
                    
                    if (error) {
                        results += `<p style="color:red">${test.desc} (${test.path}): 실패 - ${error.message}</p>`;
                    } else {
                        results += `<p style="color:green">${test.desc} (${test.path}): 성공!</p>`;
                        // 성공한 파일 삭제
                        await supabase.storage.from('media').remove([test.path]);
                    }
                }
                
                resultDiv.innerHTML = results;
                
            } catch (error) {
                resultDiv.innerHTML = `<p style="color:red">에러: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>