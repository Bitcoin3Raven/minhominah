<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¯¼í˜¸ë¯¼ì•„ - Supabase ì—°ë™ í…ŒìŠ¤íŠ¸</title>
    
    <!-- Supabase í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- í”„ë¡œì íŠ¸ ì„¤ì • -->
    <script src="../config/supabase.js"></script>
    
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        input, button {
            margin: 5px 0;
            padding: 10px;
            width: 100%;
            box-sizing: border-box;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        #userInfo {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸˆ ë¯¼í˜¸ë¯¼ì•„ ì„±ì¥ ì•¨ë²” - Supabase í…ŒìŠ¤íŠ¸</h1>
        
        <!-- ì—°ê²° ìƒíƒœ -->
        <div class="section">
            <h2>1. Supabase ì—°ê²° ìƒíƒœ</h2>
            <div id="connectionStatus" class="status info">ì—°ê²° í™•ì¸ ì¤‘...</div>
        </div>
        
        <!-- ì¸ì¦ í…ŒìŠ¤íŠ¸ -->
        <div class="section">
            <h2>2. ì¸ì¦ í…ŒìŠ¤íŠ¸</h2>
            <div id="authStatus" class="status info">ë¡œê·¸ì¸í•˜ì§€ ì•ŠìŒ</div>
            <div id="userInfo" style="display:none;"></div>
            
            <h3>íšŒì›ê°€ì…</h3>
            <input type="email" id="signupEmail" placeholder="ì´ë©”ì¼">
            <input type="password" id="signupPassword" placeholder="ë¹„ë°€ë²ˆí˜¸">
            <button onclick="signUp()">íšŒì›ê°€ì…</button>
            
            <h3>ë¡œê·¸ì¸</h3>
            <input type="email" id="loginEmail" placeholder="ì´ë©”ì¼">
            <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸">
            <button onclick="signIn()">ë¡œê·¸ì¸</button>
            <button onclick="signOut()" style="background: #dc3545;">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
        
        <!-- ë°ì´í„° í…ŒìŠ¤íŠ¸ -->
        <div class="section">
            <h2>3. ë°ì´í„° í…ŒìŠ¤íŠ¸</h2>
            <h3>í…ŒìŠ¤íŠ¸ ë©”ëª¨ë¦¬ ìƒì„±</h3>
            <input type="text" id="memoryTitle" placeholder="ì œëª© (ì˜ˆ: ë¯¼í˜¸ ì²« ìƒì¼)">
            <input type="date" id="memoryDate">
            <textarea id="memoryDescription" placeholder="ì„¤ëª…" style="width: 100%; height: 100px;"></textarea>
            <button onclick="createMemory()">ë©”ëª¨ë¦¬ ìƒì„±</button>
            
            <h3>ë©”ëª¨ë¦¬ ëª©ë¡</h3>
            <button onclick="loadMemories()">ë©”ëª¨ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <div id="memoriesList"></div>
        </div>
    </div>
    
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentUser = null;
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        window.onload = async function() {
            // Supabase ì—°ê²° í™•ì¸
            checkConnection();
            
            // í˜„ì¬ ì„¸ì…˜ í™•ì¸
            if (supabaseClient) {
                const { data: { session } } = await supabaseClient.auth.getSession();
                if (session) {
                    currentUser = session.user;
                    updateAuthStatus(true);
                }
            }
        };
        
        // Supabase ì—°ê²° ìƒíƒœ í™•ì¸
        function checkConnection() {
            const status = document.getElementById('connectionStatus');
            if (supabaseClient) {
                status.className = 'status success';
                status.textContent = 'âœ… Supabase ì—°ê²° ì„±ê³µ!';
            } else {
                status.className = 'status error';
                status.textContent = 'âŒ Supabase ì—°ê²° ì‹¤íŒ¨ - config/supabase.js íŒŒì¼ì˜ ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.';
            }
        }
        
        // íšŒì›ê°€ì…
        async function signUp() {
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            
            if (!email || !password) {
                alert('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            try {
                const { data, error } = await supabaseClient.auth.signUp({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                alert('íšŒì›ê°€ì… ì„±ê³µ! ì´ë©”ì¼ì„ í™•ì¸í•˜ì„¸ìš”.');
                document.getElementById('signupEmail').value = '';
                document.getElementById('signupPassword').value = '';
            } catch (error) {
                alert('íšŒì›ê°€ì… ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ë¡œê·¸ì¸
        async function signIn() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                alert('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            try {
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                currentUser = data.user;
                updateAuthStatus(true);
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginPassword').value = '';
            } catch (error) {
                alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ë¡œê·¸ì•„ì›ƒ
        async function signOut() {
            try {
                const { error } = await supabaseClient.auth.signOut();
                if (error) throw error;
                
                currentUser = null;
                updateAuthStatus(false);
            } catch (error) {
                alert('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ì¸ì¦ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateAuthStatus(isLoggedIn) {
            const authStatus = document.getElementById('authStatus');
            const userInfo = document.getElementById('userInfo');
            
            if (isLoggedIn && currentUser) {
                authStatus.className = 'status success';
                authStatus.textContent = 'âœ… ë¡œê·¸ì¸ë¨';
                userInfo.style.display = 'block';
                userInfo.innerHTML = `
                    <strong>ì‚¬ìš©ì ì •ë³´:</strong><br>
                    ì´ë©”ì¼: ${currentUser.email}<br>
                    ID: ${currentUser.id}
                `;
            } else {
                authStatus.className = 'status info';
                authStatus.textContent = 'ë¡œê·¸ì¸í•˜ì§€ ì•ŠìŒ';
                userInfo.style.display = 'none';
            }
        }
        
        // ë©”ëª¨ë¦¬ ìƒì„±
        async function createMemory() {
            if (!currentUser) {
                alert('ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.');
                return;
            }
            
            const title = document.getElementById('memoryTitle').value;
            const date = document.getElementById('memoryDate').value;
            const description = document.getElementById('memoryDescription').value;
            
            if (!title || !date) {
                alert('ì œëª©ê³¼ ë‚ ì§œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');
                return;
            }
            
            try {
                const { data, error } = await supabaseClient
                    .from('memories')
                    .insert([
                        {
                            title: title,
                            memory_date: date,
                            description: description,
                            created_by: currentUser.id
                        }
                    ]);
                
                if (error) throw error;
                
                alert('ë©”ëª¨ë¦¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
                document.getElementById('memoryTitle').value = '';
                document.getElementById('memoryDate').value = '';
                document.getElementById('memoryDescription').value = '';
                loadMemories();
            } catch (error) {
                alert('ë©”ëª¨ë¦¬ ìƒì„± ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ë©”ëª¨ë¦¬ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadMemories() {
            try {
                const { data, error } = await supabaseClient
                    .from('memories')
                    .select('*')
                    .order('memory_date', { ascending: false });
                
                if (error) throw error;
                
                const memoriesList = document.getElementById('memoriesList');
                if (data && data.length > 0) {
                    memoriesList.innerHTML = '<h4>ì €ì¥ëœ ë©”ëª¨ë¦¬:</h4>' + 
                        data.map(memory => `
                            <div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 5px;">
                                <strong>${memory.title}</strong><br>
                                ë‚ ì§œ: ${memory.memory_date}<br>
                                ${memory.description ? 'ì„¤ëª…: ' + memory.description : ''}
                            </div>
                        `).join('');
                } else {
                    memoriesList.innerHTML = '<p>ì €ì¥ëœ ë©”ëª¨ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } catch (error) {
                alert('ë©”ëª¨ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + error.message);
                document.getElementById('memoriesList').innerHTML = 
                    '<p class="error">í…Œì´ë¸”ì´ ì—†ê±°ë‚˜ ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. Supabase ëŒ€ì‹œë³´ë“œì—ì„œ í…Œì´ë¸”ì„ ìƒì„±í•˜ì„¸ìš”.</p>';
            }
        }
    </script>
</body>
</html>
